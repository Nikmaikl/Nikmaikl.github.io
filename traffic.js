window.onload = init;var layer;var ctxLayer;var canvasWidth = 800;var canvasHeight = 600;var trafficImage = new Image();trafficImage.src = "img/off.png";var isPlaying;var getStr;var stateTitle;var updateButton;var requestAnimFrame = window.requestAnimationFrame ||						window.webkitRequestAnimationFrame ||						window.mozRequestAnimationFrame ||						window.oRequestAnimationFrame ||						window.msRequestAnimationFrame;function init(){	layer = document.getElementById("layer");	ctxLayer = layer.getContext("2d");		getStr = document.getElementById("getStr");	stateTitle = document.getElementById("stateTitle");	updateButton = document.getElementById("updateButton");	updateButton.addEventListener("click", updateTraffic, false);		layer.width = canvasWidth;	layer.height = canvasHeight;	ymaps.ready(initMap);    var myMap;	// var traffic = new YMaps.Traffic.Control();		startLoop();}var trafficProvider;function initMap(){             myMap = new ymaps.Map("map", {            center: [55.76, 37.64],            zoom: 7        });                trafficProvider = new ymaps.traffic.provider.Actual();        trafficProvider.setMap(myMap);                trafficProvider.state.events.add('change', function () {			updateTraffic();				});}function loop(){	if(isPlaying)	{		draw();		requestAnimFrame(loop);	}}function startLoop(){	isPlaying = true;	loop();}function stopLoop(){	isPlaying = false;}function draw(){	drawTraffic();}function updateTraffic() {    if (trafficProvider.state.get('isInited')) {        var style = trafficProvider.state.get('iconStyle');        var level = trafficProvider.state.get('level');        if (style != undefined) {        	trafficImage.src = "img/"+style+".png";        	stateTitle.innerHTML = "Состояние пробок - " + level + " баллов"        }     }}function drawTraffic() {	var w = 510	var h = 600	ctxLayer.drawImage(trafficImage, 0, 0, w, h,		canvasWidth/2-w/2, canvasHeight/2-h/2, w, h);}